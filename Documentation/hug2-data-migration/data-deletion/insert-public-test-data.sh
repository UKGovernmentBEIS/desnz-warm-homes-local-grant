#!/bin/bash

# SQL commands
SQL_COMMANDS=$(cat <<EOF
-- Script to populate the to-be-emptied Public tables with test data
BEGIN;

-- Clear existing data
TRUNCATE TABLE "sessioncache", "ReferralRequestFollowUps", "ReferralRequests", "NotificationDetails";

-- Populate referral requests to allow follow ups something to reference
INSERT INTO public."ReferralRequests" ("Id",
                                       "AddressLine1", "AddressPostcode", "CustodianCode", "EpcRating", "IsLsoaProperty",
                                       "IncomeBand", "FullName", "ContactEmailAddress", "RequestDate",
                                       "WasSubmittedToPendingLocalAuthority", "WasSubmittedForFutureGrants", "ReferralWrittenToCsv"
) VALUES
      (1,'123 Active LA St', 'AC1 1LA', 'ACT001', 7, TRUE, 4, 'John Doe', 'john@example.com',
       '2024-12-15', FALSE, FALSE, TRUE),
      (2,'456 Active LA St', 'AC2 2LA', 'ACT002', 7, FALSE, 4, 'Jane Smith', 'jane@example.com',
       '2024-12-20', FALSE, FALSE, TRUE),
      (3,'789 Active LA St', 'AC3 3LA', 'ACT003', 7, TRUE, 4, 'Bob Johnson', 'bob@example.com',
       '2024-12-25', FALSE, FALSE, TRUE);

INSERT INTO public."ReferralRequestFollowUps" ("ReferralRequestId", "Token", "WasFollowedUp", "DateOfFollowUpResponse"
) VALUES (1, 'test-token-1', 'True', '2024-05-05 17:19:37.000000'),
         (2, 'test-token-2', 'False', '2023-01-02 12:10:40.0000000');

INSERT INTO public."sessioncache" ("Id", "Value", "ExpiresAtTime", "SlidingExpirationInSeconds"
) VALUES
      ('9115e9f2-ee64-334f-bcec-5144cb3385f8',
       '0x02000001B363D274E335DE4F2C6909DBDF58D019000E5F5175657374696F6E6E61697265000004077B2253657373696F6E4964223A392C22436F756E747279223A22456E676C616E64222C224F776E657273686970537461747573223A224F776E65724F63637570616E6379222C22416464726573734C696E6531223A6E756C6C2C22416464726573734C696E6532223A6E756C6C2C2241646472657373546F776E223A6E756C6C2C2241646472657373436F756E7479223A6E756C6C2C2241646472657373506F7374636F6465223A6E756C6C2C22437573746F6469616E436F6465223A6E756C6C2C224C6F63616C417574686F72697479436F6E6669726D6564223A6E756C6C2C225570726E223A6E756C6C2C2245706344657461696C73223A6E756C6C2C2245706344657461696C73417265436F7272656374223A6E756C6C2C2249734C736F6150726F7065727479223A6E756C6C2C2241636B6E6F776C656467656450656E64696E67223A6E756C6C2C2241636B6E6F776C6564676564467574757265526566657272616C223A6E756C6C2C22496E636F6D6542616E64223A6E756C6C2C22526566657272616C43726561746564223A22303030312D30312D30315430303A30303A3030222C22526566657272616C436F6465223A6E756C6C2C224C61436F6E746163744E616D65223A6E756C6C2C224C6143616E436F6E746163744279456D61696C223A6E756C6C2C224C6143616E436F6E74616374427950686F6E65223A6E756C6C2C224C61436F6E74616374456D61696C41646472657373223A6E756C6C2C224C61436F6E7461637454656C6570686F6E65223A6E756C6C2C224E6F74696669636174696F6E436F6E73656E74223A6E756C6C2C22436F6E6669726D6174696F6E436F6E73656E74223A6E756C6C2C224E6F74696669636174696F6E456D61696C41646472657373223A6E756C6C2C22436F6E6669726D6174696F6E456D61696C41646472657373223A6E756C6C2C22556E65646974656444617461223A6E756C6C2C224973456C696769626C65466F7257686C67223A747275652C224C6F63616C417574686F726974794E616D65223A22756E7265636F676E69736564204C6F63616C20417574686F72697479222C224C6F63616C417574686F7269747957656273697465223A22756E7265636F676E69736564204C6F63616C20417574686F72697479222C224C6F63616C417574686F72697479537461747573223A6E756C6C2C2245666665637469766545706342616E64223A22556E6B6E6F776E222C22446973706C6179457063526174696E67223A22556E6B6E6F776E222C22466F756E6445706342616E644973546F6F48696768223A66616C73652C224570634973546F6F48696768223A66616C73652C22496E636F6D654973546F6F48696768223A66616C73652C22496E636F6D6542616E64497356616C6964223A66616C73657D',
       '2025-02-05 22:41:20.367138 +00:00'::timestamptz, 18000),
      ('0d43007e-775e-8f41-c314-05cb406d70a1',
       '0x02000001A8876C093EC5D2A0E65DA4F90EABD189000E5F5175657374696F6E6E61697265000004087B2253657373696F6E4964223A31302C22436F756E747279223A22456E676C616E64222C224F776E657273686970537461747573223A224F776E65724F63637570616E6379222C22416464726573734C696E6531223A6E756C6C2C22416464726573734C696E6532223A6E756C6C2C2241646472657373546F776E223A6E756C6C2C2241646472657373436F756E7479223A6E756C6C2C2241646472657373506F7374636F6465223A6E756C6C2C22437573746F6469616E436F6465223A6E756C6C2C224C6F63616C417574686F72697479436F6E6669726D6564223A6E756C6C2C225570726E223A6E756C6C2C2245706344657461696C73223A6E756C6C2C2245706344657461696C73417265436F7272656374223A6E756C6C2C2249734C736F6150726F7065727479223A6E756C6C2C2241636B6E6F776C656467656450656E64696E67223A6E756C6C2C2241636B6E6F776C6564676564467574757265526566657272616C223A6E756C6C2C22496E636F6D6542616E64223A6E756C6C2C22526566657272616C43726561746564223A22303030312D30312D30315430303A30303A3030222C22526566657272616C436F6465223A6E756C6C2C224C61436F6E746163744E616D65223A6E756C6C2C224C6143616E436F6E746163744279456D61696C223A6E756C6C2C224C6143616E436F6E74616374427950686F6E65223A6E756C6C2C224C61436F6E74616374456D61696C41646472657373223A6E756C6C2C224C61436F6E7461637454656C6570686F6E65223A6E756C6C2C224E6F74696669636174696F6E436F6E73656E74223A6E756C6C2C22436F6E6669726D6174696F6E436F6E73656E74223A6E756C6C2C224E6F74696669636174696F6E456D61696C41646472657373223A6E756C6C2C22436F6E6669726D6174696F6E456D61696C41646472657373223A6E756C6C2C22556E65646974656444617461223A6E756C6C2C224973456C696769626C65466F7257686C67223A747275652C224C6F63616C417574686F726974794E616D65223A22756E7265636F676E69736564204C6F63616C20417574686F72697479222C224C6F63616C417574686F7269747957656273697465223A22756E7265636F676E69736564204C6F63616C20417574686F72697479222C224C6F63616C417574686F72697479537461747573223A6E756C6C2C2245666665637469766545706342616E64223A22556E6B6E6F776E222C22446973706C6179457063526174696E67223A22556E6B6E6F776E222C22466F756E6445706342616E644973546F6F48696768223A66616C73652C224570634973546F6F48696768223A66616C73652C22496E636F6D654973546F6F48696768223A66616C73652C22496E636F6D6542616E64497356616C6964223A66616C73657D',
       '2025-02-05 22:52:31.873224 +00:00'::timestamptz,18000);

COMMIT;
EOF
)

# Execute the SQL commands
echo "Executing SQL commands..."
echo "$SQL_COMMANDS" | PGPASSWORD=$DB_PASSWORD psql -h "$DB_HOST" -U mysqladm -d "$DB_NAME"

echo "SQL commands executed successfully."